doctype html
html(lang="en", ng-app="EventorioApp")
  include ../layouts/head.server.jade
  include ../layouts/scripts.server.jade
  body
    include ../layouts/header.server.jade
    .content-fluid(ng-controller="UserController")
      .row-fluid(ng-show="show")
        img.img-responsive.img-user-header(src="/img/user_background.png")

        .user-header.col-lg-12
          .row-fluid
            .col-lg-4.col-lg-offset-1.col-xs-3.col-xs-offset-1
              .row
                .user-thumbnail
                  img.img-responsive.img-thumbnail.col-lg-8.hidden-xs(ng-src="{{user.picture}}")
                  img.img-responsive.col-xs-12.visible-xs(ng-src="{{user.picture}}")
              .row.hidden-xs
                .col-lg-offset-1.user-name
                  div(ng-if="user.name")
                    a.editable(ng-if="editable", style="font-size: 2em;") {{user.name}}
                    p(ng-if="!editable", style="font-size: 2em;") {{user.name}}
                  div(ng-if="!user.name")
                    a.editable(ng-if="editable", style="color: grey; font-size: 1.7em; opacity: 0.5;") Enter your name
                    p(ng-if="!editable", style="color: grey; font-size: 1.7em;") No name
              .row.hidden-xs
                .col-lg-4.text-center
                  a(href="#", data-toggle="modal", data-target="#peopleModal", ng-click="people='followers'")
                    | {{user.followers.length || 0}}
                    br
                    | Followers
                .col-lg-4.text-center
                  a(href="#", data-toggle="modal", data-target="#peopleModal", ng-click="people='following'")
                    | {{user.following.length || 0}}
                    br
                    | Following

              .row-fluid.hidden-xs(ng-if="global.me && editable")
                .col-lg-8.text-center
                  .row(ng-show="!changePasswordView")
                    button.btn.btn-info.col-lg-12(ng-click="changePasswordView=true") Change password
                  .row(ng-show="changePasswordView")
                    form
                      .form-group
                        input.col-lg-10.form-control(ng-model="credentials.oldPassword", type="password", placeholder="Old password")
                      .form-group
                        input.col-lg-10.form-control(ng-model="credentials.newPassword", type="password", placeholder="New password")
                      .form-group
                        input.col-lg-10.form-control(ng-model="credentials.newPasswordRepeat", type="password", placeholder="New password")
                      .changePasswordForm
                      button.btn.btn-warning(type="submit", ng-click="changePassword()") Change
                      button.btn.btn-default(type="submit", ng-click="changePasswordView = false") Cancel

              .row-fluid.hidden-xs(ng-if="global.me && !editable")
                .col-lg-8.text-center
                  button.btn.btn-success.col-lg-12(
                    ng-if="!isFollowing"
                    ng-click="follow()") Follow
                  button.btn.btn-default.btn-sm.col-lg-6.col-lg-offset-3(
                    ng-if="isFollowing"
                    ng-click="unfollow()") Unfollow

            .user-username.col-lg-7.col-xs-8 {{user.username}}
              .row.visible-xs
                .col-xs-12.user-name(style="color: black")
                  div(ng-if="user.name")
                    a.editable(ng-if="editable") {{user.name}}
                    p(ng-if="!editable") {{user.name}}
                  div(ng-if="!user.name")
                    a.editable(ng-if="editable", style="color: grey; opacity: 0.5;") Enter your name
                    p(ng-if="!editable", style="color: grey;") No name

            .row-fluid.visible-xs
              .user-events.col-xs-12.visible-xs(ng-if="user.events")
                p.text-center(ng-if="user.events.length === 0", style="color: grey; opacity: 0.7") No upcoming events
                p.text-center(ng-if="user.events.length !== 0 && !editable") {{user.username}}'s upcoming events:
                p.text-center(ng-if="user.events.length !== 0 && editable") Your upcoming events:
                .col-lg-6.col-xs-12(ng-repeat="event in user.events" event-line event="event")

            .row.visible-xs
              .user-description.col-xs-10.col-xs-offset-1
                div(ng-if="user.desc")
                  a.editable(ng-if="editable") {{user.desc}}
                  p(ng-if="!editable") {{user.desc}}
                div(ng-if="!user.desc")
                  a.editable(ng-if="editable", style="opacity: 0.5;") Tell us something about you
                  p(ng-if="!editable") No description

            .row-fluid.visible-xs(ng-if="global.me && !editable")
              .col-xs-12.text-center
                button.btn.btn-success.col-xs-12(
                  ng-if="global.me.following.indexOf(user.id) === -1"
                  ng-click="follow()") Follow
                button.btn.btn-default.btn-sm.col-lg-6.col-xs-offset-3(
                  ng-if="global.me.following.indexOf(user.id) !== -1"
                  ng-click="unfollow()") Unfollow

            .row.visible-xs
              .col-xs-6.text-center
                a(href="#", data-toggle="modal", data-target="#peopleModal", ng-click="people='followers'")
                  | {{user.followers.length || 0}}
                  br
                  | Followers
              .col-xs-6.text-center
                a(href="#", data-toggle="modal", data-target="#peopleModal", ng-click="people='following'")
                  | {{user.following.length || 0}}
                  br
                  | Following

              .row-fluid.visible-xs(ng-if="global.me && editable")
                .col-xs-8.col-xs-offset-2.text-center
                  .row(ng-show="!changePasswordView")
                    button.btn.btn-info.col-lg-12(ng-click="changePasswordView=true") Change password
                  .row(ng-show="changePasswordView")
                    form
                      .form-group
                        input.col-xs-10.form-control(ng-model="credentials.oldPassword", type="password", placeholder="Old password")
                      .form-group
                        input.col-xs-10.form-control(ng-model="credentials.newPassword", type="password", placeholder="New password")
                      .form-group
                        input.col-xs-10.form-control(ng-model="credentials.newPasswordRepeat", type="password", placeholder="New password")
                      .changePasswordForm
                      button.btn.btn-warning(type="submit", ng-click="changePassword()") Change
                      button.btn.btn-default(type="submit", ng-click="changePasswordView = false") Cancel

          .row-fluid.hidden-xs
            .user-description.col-lg-7
              div(ng-if="user.desc")
                a.editable(ng-if="editable", style="font-size: 2em") {{user.desc}}
                p(ng-if="!editable", style="font-size: 2em") {{user.desc}}
              div(ng-if="!user.desc")
                a.editable(ng-if="editable", style="font-size: 1.7em; opacity: 0.5;") Tell us something about you
                p(ng-if="!editable", style="font-size: 2em") No description

            .user-events.col-lg-7(ng-if="user.events")
              h3(ng-if="!editable") {{user.username}}'s upcoming events:
              h3(ng-if="editable") Your upcoming events:
              .col-lg-6(ng-repeat="event in user.events" event-line event="event")

      #peopleModal.modal.fade(tabindex="-1", role="dialog", aria-hidden="true")
        .modal-dialog
          .modal-content
            .modal-header
              button.close(type='button', data-dismiss='modal')
                span(aria-hidden='true') Ã—
                span.sr-only Close
              h4.modal-title(ng-if="people==='followers'") Followers
              h4.modal-title(ng-if="people==='following'") Following
            .modal-body
              .row(ng-if="people === 'followers'")
                .col-lg-3.col-xs-4(ng-repeat="u in user.followers", user-small, user="u")
              .row(ng-if="people === 'following'")
                .col-lg-3.col-xs-4(ng-repeat="u in user.following", user-small, user="u")
            .modal-footer
              button.btn.btn-default(type='button', data-dismiss='modal') Ok